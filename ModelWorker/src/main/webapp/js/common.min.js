/**
 * Created by apple on 16/6/19.
 */
define(['jquery','datepicker','app','exports'],function($, app, bootstrap, exports){

    console.log('jquery:',$);

    //bootstrap date picker cn
    !function(a){a.fn.datepicker.dates["zh-CN"]={days:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],daysShort:["周日","周一","周二","周三","周四","周五","周六"],daysMin:["日","一","二","三","四","五","六"],months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthsShort:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],today:"今日",clear:"清除",format:"yyyy年mm月dd日",titleFormat:"yyyy年mm月",weekStart:1}}(jQuery);

    $(function(){
        $('.form_datetime,.form_date,.form_time').attr({'type':'text','placeholder':'选择日期'}).datepicker({'language':'zh-CN',format: "yyyy-mm-dd"});
    });


    //datatables options
    var tableLanguage = {
        "sProcessing": "处理中...",
        "sLengthMenu": "显示 _MENU_ 项结果",
        "sZeroRecords": "没有匹配结果",
        "sInfo": "显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",
        "sInfoEmpty": "显示第 0 至 0 项结果，共 0 项",
        "sInfoFiltered": "(由 _MAX_ 项结果过滤)",
        "sInfoPostFix": "",
        "sSearch": "搜索:",
        "sUrl": "",
        "sEmptyTable": "表中数据为空",
        "sLoadingRecords": "载入中...",
        "sInfoThousands": ",",
        "oPaginate": {
            "sFirst": "首页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "末页"
        },
        "oAria": {
            "sSortAscending": ": 以升序排列此列",
            "sSortDescending": ": 以降序排列此列"
        }
    }


    //core js prototype
    String.prototype.replaceAll = function(s1, s2) {
        return this.replace(new RegExp(s1, "gm"), s2); //g全局
    }

    Date.prototype.format = function(fmt) { // author: meizz
        var o = {
            "M+" : this.getMonth() + 1, // 月份
            "d+" : this.getDate(), // 日
            "h+" : this.getHours(), // 小时
            "m+" : this.getMinutes(), // 分
            "s+" : this.getSeconds(), // 秒
            "q+" : Math.floor((this.getMonth() + 3) / 3), // 季度
            "S" : this.getMilliseconds()
            // 毫秒
        };
        if (/(y+)/.test(fmt))
            fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "")
                .substr(4 - RegExp.$1.length));
        for ( var k in o)
            if (new RegExp("(" + k + ")").test(fmt))
                fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k])
                    : (("00" + o[k]).substr(("" + o[k]).length)));
        return fmt;
    }


    Number.prototype.formatMoney = function(c, d, t) {
        var n = this, c = isNaN(c = Math.abs(c)) ? 2 : c, d = d == undefined ? "."
            : d, t = t == undefined ? "," : t, s = n < 0 ? "-" : "", i = parseInt(n = Math
                .abs(+n || 0).toFixed(c))
            + "", j = (j = i.length) > 3 ? j % 3 : 0;
        return s + (j ? i.substr(0, j) + t : "")
            + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + t)
            + (c ? d + Math.abs(n - i).toFixed(c).slice(2) : "");
    };


    $(document).ready(function() {
        /*table 中的checkbox 的全选功能  */
        $("#allCheck").click(function() {

            var selected = $(this).prop("checked");
            $(".dataTable tbody input[type='checkbox']").prop("checked", selected);

            var rows = $('.dataTable tbody tr');
            $('.dataTable tbody tr').each(function(){
                if($(this).find(":checkbox").prop("checked") == true){
                    $(this).addClass('selected');
                }

                if($(this).find(":checkbox").prop("checked") == false){
                    $(this).removeClass('selected');
                }
            });
        });
    });

    var MessageBox = {
        info : function(message, callback) {
            $("#infoModal .modal-body").html(message);
            $("#infoModal .modal-footer .btn").unbind("click");
            $("#infoModal .modal-footer .btn").bind("click", function() {
                if (callback) {
                    callback();
                }
            });
            var modal = $("#infoModal").modal();
            modal.show();
        },
        error : function(message, callback) {
            $("#errorModal .modal-body").text(message);
            $("#errorModal .modal-footer .btn").unbind("click");
            $("#errorModal .modal-footer .btn").bind("click", function() {
                if (callback) {
                    callback();
                }
            });
            var modal = $("#errorModal").modal();
            modal.show();
        },
        confirm : function(message, callbackYes, callbackNo) {
            $("#confirmModal .modal-body").html(message);
            $("#confirmModal .modal-footer .btn-default").unbind("click");
            $("#confirmModal .modal-footer .btn-default").bind("click", function() {
                if (callbackNo) {
                    callbackNo();
                }
            });
            $("#confirmModal .modal-footer .btn-primary").unbind("click");
            $("#confirmModal .modal-footer .btn-primary").bind("click", function() {
                if (callbackYes) {
                    callbackYes();
                }
            });
            var modal = $("#confirmModal").modal();
            modal.show();
        }
    }

    $.fn.reset = function() {
        this.validate().resetForm();
        this.find(".error").removeClass("error");
    }

    $.fn.serializeJson=function(){
        var serializeObj={};
        $(this.serializeArray()).each(function(){
            serializeObj[this.name]=this.value;
        });
        return serializeObj;
    };


    //验证数值输入（可带小数）
    function checkDecimal(param1, param2, value) {
        if (new RegExp("^-?\\d{1," + param1 + "}(\\.\\d{1," + param2 + "})?$").test(value)) {
            return true;
        } else {
            return false;
        }
    }

    var Formatter = {
        formatDate : function(date) {
            if (date != null && date != '' && date != 'undefined' && date != 'null') {
                return new Date(date).format("yyyy-MM-dd");
            }
            return '';
        },
        formatDateTime : function(date) {
            if (date != null && date != '' && date != 'undefined' && date != 'null') {
                return new Date(date).format("yyyy-MM-dd hh:mm:ss");
            }
            return '';
        },

        formatNumber : function(num) {
            if (num != null && num != '' && num != 'undefined' && num != 'null') {
                return new Number(num).formatMoney(2, ".", ",");
            }
            return "";
        },
        formatMoney : function(num) {
            if (num != null && num != '' && num != 'undefined' && num != 'null') {
                return new Number(num).formatMoney(0, ".", ",");
            }
            return num;
        }
    };


    //temp active
    $(".sidebar-menu li a").each(function(i,v){
        var href     = $(this).attr('href').replace('.html','')
        var location = window.location.href.replace('#','');
        var isActive = location.search(href)
        var isSingle = $(this).parent().parent().hasClass('sidebar-menu');

        if(isActive > 0){
            $(this).addClass('text-red').parent().addClass('active');
            if(isSingle == false){
                $(this).parent().parent().parent().addClass('active');
            }else{
                $(this).parent().parent().addClass('active');
            }
        }
    })


    $('.date').datepicker({
        lang : 'zh-CN'
    });



})


